<!--inherits the layout-->
{% extends 'index.html' %}
<!--passes the page title-->
{% block title %}{{page_title}}{% endblock title %}
<!--content starts-->
{% block content %}
 <div class="container">
    <div class="row">

        <div class="col-md-6">
            <div class="todolist not-done">
             <h1>To Do List</h1>
                <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <a class="nav-link active" id="pills-active-todo-tab" data-toggle="pill" href="#active-todo" role="tab" aria-controls="active-todo" aria-selected="true">Active</a>
                    </li>
                    <li class="nav-item" role="presentation">
                        <a class="nav-link" id="pills-history-tab" data-toggle="pill" href="#history" role="tab" aria-controls="history" aria-selected="false">History</a>
                    </li>
                </ul>
                <div class="tab-content" id="pills-tabContent">
                    <div class="tab-pane fade show active" id="active-todo" role="tabpanel" aria-labelledby="pills-active-todo-tab">
                    <hr>
                        <div class="table-responsive" style="height:60vh;">
                            <table class="table">
                                <tbody>
                                {%for obj in object_list%}
                                 <tr>
                                     <td><input type="checkbox" value={{obj.pk}} onclick="window.location.href='/soft-delete/{{obj.pk}}/'" /></td>
                                     <td>
                                         {%if obj.record_type == 'text'%}
                                            {{obj.text_record|safe}}
                                        {%elif obj.record_type == 'audio' and obj.voice_record%}
                                        <audio src="{{obj.voice_record.url}}" controls></audio>
                                        {%elif obj.record_type == 'video' and obj.voice_record%}
                                         <a href="#videoModal{{obj.pk}}" data-toggle="modal" data-target="#videoModal{{obj.pk}}">Recorded Video</a>
                                         {%include 'webapp/video_modal.html'%}
                                         {%endif%}
                                     </td>
                                     <td><span class="badge badge-pill badge-light">{{obj.created_at}}</span></td>
                                 </tr>
                                 {%endfor%}
                                </tbody>
                            </table>
                        </div>
                        <div class="todo-footer">
                            <strong><span class="count-todos"></span></strong> <span class="badge badge-success">Total Count: {{object_list|length}}</span>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="history" role="tabpanel" aria-labelledby="pills-history-tab">
                                 <hr>
                        <div class="table-responsive" style="height:60vh;">
                            <table class="table">
                                <tbody>
                                {%for obj in history%}
                                 <tr>
                                     <td><i class="fas fa-check-square text-success"></i></td>
                                     <td>
                                         {%if obj.record_type == 'text'%}
                                            {{obj.text_record|safe}}
                                        {%elif obj.record_type == 'audio' and obj.voice_record%}
                                        <audio style="width:100%;" src="{{obj.voice_record.url}}" controls></audio>
                                        {%elif obj.record_type == 'video' and obj.voice_record%}
                                         <a href="#videoModal{{obj.pk}}" data-toggle="modal" data-target="#videoModal{{obj.pk}}">Recorded Video</a>
                                         {%include 'webapp/video_modal.html'%}
                                         {%endif%}
                                     </td>
                                     <td><span class="badge badge-pill badge-light">{{obj.created_at}}</span></td>
                                 </tr>
                                 {%endfor%}
                                </tbody>
                            </table>
                        </div>
                        <div class="todo-footer">
                            <strong><span class="count-todos"></span></strong> <span class="badge badge-success">Total Count: {{history|length}}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="todolist">
             <h1>Add To Do</h1>
                <ul class="list-inline">
                <li class="list-inline-item">
                    <span id="id_video" class="btn btn-primary">Video</span>
                </li>
                <li class="list-inline-item">
                    <span id="id_audio">Audio</span>
                </li>
                <li class="list-inline-item">
                    <span id="id_text">Text</span>
                </li>
            </ul>
            <div class="col-md-12" id="div_video">
                    <section class="section">
                        <div class="container">
                            <div class="columns">
                                <div class="column is-offset-4 is-4">
                                    <article class="message is-success" id="video_alert">
                                        <div class="text-success">
                                            You have successfully recorded your message. You can now click on
                                            the Create button to post it.
                                        </div>
                                    </article>
                                    <article class="message is-success" id="video_error">
                                        <div class="text-danger">
                                            Please record the Video!
                                        </div>
                                    </article>
                                    <form method="POST" enctype="multipart/form-data">
                                        {% csrf_token %}
                                        <div class="field">
                                            <small>create a video todo</small>
                                        <div class="control has-icons-left has-icons-right" style="margin-top: 1rem">
                                            <video id="recordVideo" class="video-js vjs-default-skin"></video>
                                        </div>
                                        <ul class="list-inline text-right p-2">
                                            <li class="list-inline-item">
                                                <button class="btn btn-success" id="video_submit">Create</button>
                                            </li>
                                        </ul>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </section>
            </div>

                    <div class="" id="div_text">
                <div id="textTodo" class="mt-2 p-2">
                    <form method="post" action="{%url 'record'%}">
                          {%csrf_token%}
                        <div class="form-group col-md-12">
                            <input type="text" autocomplete="off" class="form-control" name="text_record" required>
                            <input type="hidden" value="text" name="record_type">
                            <small class="text-dark text-right">Create a text todo</small>
                        </div>
                        <ul class="list-inline text-right">
                            <li class="list-inline-item">
                                <button type="submit" class="btn btn-success">Create</button>
                            </li>
                        </ul>
                    </form>
                </div>
                    </div>
                    <div id="div_audio">
                <div class="mt-2 p-2" id="audioTodo">
                    <section class="section">
                        <div class="container">
                            <div class="columns">
                                <div class="column is-offset-4 is-4">
                                    <article class="message is-success" id="alert">
                                        <div class="text-success">
                                            You have successfully recorded your message. You can now click on
                                            the Create button to post it.
                                        </div>
                                    </article>
                                    <article class="message is-success" id="error">
                                        <div class="text-danger">
                                            Please record the voice!
                                        </div>
                                    </article>
                                    <form method="POST" enctype="multipart/form-data">
                                        {% csrf_token %}
                                        <div class="field">
                                            <small>create an audio todo</small>
                                        <div class="control has-icons-left has-icons-right" style="margin-top: 1rem">
                                            <audio id="recordAudio" class="video-js vjs-default-skin"></audio>
                                        </div>
                                        <ul class="list-inline text-right p-2">
                                            <li class="list-inline-item">
                                                <button class="btn btn-success" id="submit">Create</button>
                                            </li>
                                        </ul>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                    </div>

            </div>
        </div>
    </div>
</div>


{% endblock content %}
{% block js %}
<script>
   $(document).ready(function(){
         $('#div_audio').hide();
         $('#div_text').hide();

     $('#id_text,#id_audio,#id_video').on('click',function(){
         if(this.id == 'id_video'){
            $('#id_video').prop('class','btn btn-primary');
            $('#id_text').prop('class','');
            $('#id_audio').prop('class','');
            $('#div_video').show();
            $('#div_text').hide();
            $('#div_audio').hide();

         }else if(this.id == 'id_audio'){
             $('#id_video').prop('class','');
            $('#id_text').prop('class','');
            $('#id_audio').prop('class','btn btn-primary');
            $('#div_video').hide();
            $('#div_text').hide();
            $('#div_audio').show();
         }else if(this.id == 'id_text'){
             $('#id_video').prop('class','');
            $('#id_text').prop('class','btn btn-primary');
            $('#id_audio').prop('class','');
            $('#div_video').hide();
            $('#div_text').show();
            $('#div_audio').hide();
         }
     });
   });
</script>
{% endblock js %}
